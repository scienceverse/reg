---
title: "Codebook Tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Codebook Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(scienceverse)
```

Codebooks in scienceverse follow the Psych-DS 0.1.0 format by default, although you can manually add your own codebook to the JSON file.

## Automatic Codebooks for Simulated Data

When you add simulated data to a study object, the codebook is generated by default.

```{r}
study <- study("Demo") %>%
  add_sim_data("pets",
               between = list(pet = c(cat = "Cat Owners", 
                                      dog = "Dog Owners")),
               n = c(4, 6),
               dv = list(happy = "Happiness Score"),
               id = list(id = "Subject ID"),
               mu = c(10, 12),
               sd = 4)
```

You can retrieve the codebook with the function `get_codebook()`. If you don't specify the data_id, it defaults to the first data set in the study.

```{r}
cb <- get_codebook(study, data_id = "pets")
```

If you just type the codebook object into the console, you'll see the info formatted like this.

```{r}
cb
```

But the codebook is actually a nested list formoatted like this:

```{r}
unclass(cb) %>%str()
```

You can also view it in JSON format.

```{r}
get_codebook(study, data_id = "pets", as_json = TRUE)
```

## Run Codebook on Existing Data

You can run the codebook function on existing data, but will need to manually input some things. For now, the possible properties you can set are: "description", "privacy", "type", "propertyID", "minValue", "maxValue", "levels", "ordered", "na", "naValues", "alternateName", "unitCode".

```{r}
vardesc <- list(
  description = list(speed = "Speed in miles per hour",
                     dist = "Distance in miles"),
  # min and max values can be set manually or from data
  # min and max are often outside the observed range
  minValue = list(speed = 0, dist = 0),
  maxValue = list(speed = max(cars$speed),
                  dist = max(cars$dist))
)

codebook(cars, "Built-in Cars Dataset", vardesc)
```

