<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta-Analyses • scienceverse</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Meta-Analyses">
<meta property="og:description" content="scienceverse">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-160147578-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160147578-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scienceverse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9013</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/scienceverse/scienceverse/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="meta_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Meta-Analyses</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/scienceverse/scienceverse/blob/master/vignettes/meta.Rmd"><code>vignettes/meta.Rmd</code></a></small>
      <div class="hidden name"><code>meta.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># devtools::install_github("scienceverse/scienceverse")</span>
<span class="co"># devtools::install_github("FBartos/zcurve")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scienceverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">zcurve</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">metafor</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">404</span>)
<span class="fu"><a href="../reference/scienceverse_options.html">scienceverse_options</a></span>(<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Set number of simulations</span>
<span class="no">nsim</span> <span class="kw">&lt;-</span> <span class="fl">50</span></pre></body></html></div>
<p>One benefit of storing all aspects related to machine readable hypothesis tests in a structured meta-data file is that the information can easily be accessed and re-used. In this example, we will show how a well-structured meta-data file can be used for a meta-analyses.</p>
<p>This example is part of:</p>
<p>Lakens, D., &amp; DeBruine, L. M. (2020). Improving Transparency, Falsifiability, and Rigour by Making Hypothesis Tests Machine Readable. <a href="https://doi.org/10.31234/osf.io/5xcda" class="uri">https://doi.org/10.31234/osf.io/5xcda</a></p>
<div id="the-problem" class="section level1">
<h1 class="hasAnchor">
<a href="#the-problem" class="anchor"></a>The problem</h1>
<p>Researchers face several challenges when they want to perform a meta-analysis. The first problem is a lack of access to the data underlying the reported results. Many scientific papers do not report results adequately. Despite recommendations to always report and interpret effect sizes, many researchers don’t include effect sizes in their results section. Meta-analysists can attempt to manually calculate effect sizes, but this requires knowing the means, standard deviations, correlations for within comparisons, and exact sample sizes for each condition, which are often not reported either. Effect sizes can sometimes still be approximated from test statistics, but even these are often missing for non-significant results. The second problem a meta-analysist faces is a lack of transparency about which statistical tests in the results section are related to the predictions in the introduction section. This can make it difficult to select the best test to include in a meta-analysis.</p>
<p>The structured meta-study files we propose, and that are generated by scienceverse, solve both these problems, as long as 1) researchers include the data in the meta-study file, and 2) they specify for each hypothesis which statistical test result will corroborate or falsify the predictions. We will illustrate, in a simulated example, how we can easily perform a meta-analysis based on the information in the meta-study files.</p>
<div id="set-up-the-studies" class="section level3">
<h3 class="hasAnchor">
<a href="#set-up-the-studies" class="anchor"></a>Set up the studies</h3>
<p>We will simulate 50 original studies, that will be meta-analyzed using 3 different meta-analytic approaches, namely <em>z</em>-curve, effect size meta-analysis, and <em>p</em>-curve. The studies all have the same true effect size, but sample sizes that vary between 30 and 300 for each condition. The code below generates 50 meta-study files. In this case, the files are all identical except for the datafiles (which vary because data is simulated). These 50 meta-study files are subsequently read in, and we show how to perform a <em>z</em>-curve, effect size meta-analysis, and <em>p</em>-curve using information from the meta-study files, based on either the stored test results from the analyses (i.e., the <em>p</em>-values) or by computing the required effect sizes from the raw data.</p>
<p>All studies measure the effect of a treatment on happiness among selected pet owners. The main research question is whether the treatment influences happiness - but all studies also include a second measured variable, asking people which pet they have (all participants have either a cat or a dog). The primary research question of the effect of the treatment on happiness is examined in an independent <em>t</em>-test.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># make a directory to store the meta-study files</span>
<span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(<span class="st">"metastudies"</span>)) <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(<span class="st">"metastudies"</span>)

<span class="co"># set up study</span>
<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/study.html">study</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Study"</span>,
                     <span class="kw">abstract</span> <span class="kw">=</span> <span class="st">"Examining the effect of an intervention on happiness"</span>)

<span class="co"># Add a hypothesis</span>
<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_hypothesis.html">add_hypothesis</a></span>(
  <span class="kw">study</span> <span class="kw">=</span> <span class="no">sim_study</span>,
  <span class="kw">description</span> <span class="kw">=</span> <span class="st">"Self-reported happiness will differ in the treatment group compared to the control group"</span>,
  <span class="kw">id</span> <span class="kw">=</span> <span class="st">"H1"</span>
)

<span class="co"># Add an analysis</span>
<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_analysis.html">add_analysis</a></span>(
  <span class="no">sim_study</span>,
  <span class="kw">id</span> <span class="kw">=</span> <span class="st">"ttest"</span>,
  <span class="kw">code</span> <span class="kw">=</span> <span class="kw pkg">scienceverse</span><span class="kw ns">::</span><span class="fu"><a href="../reference/t_test.html">t_test</a></span>(<span class="no">happiness</span>~<span class="no">treatment</span>,
                <span class="kw">data</span> <span class="kw">=</span> <span class="no">dat</span>,
                <span class="kw">alternative</span> <span class="kw">=</span> <span class="st">"two.sided"</span>,
                <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                <span class="kw">conf.level</span> <span class="kw">=</span> <span class="fl">0.95</span>),
  <span class="kw">software</span> <span class="kw">=</span> <span class="no">R.version.string</span>)

<span class="co"># Add a criterion</span>
<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_criterion.html">add_criterion</a></span>(
  <span class="no">sim_study</span>,
  <span class="kw">id</span> <span class="kw">=</span> <span class="st">"p_val"</span>,
  <span class="kw">hypothesis_id</span> <span class="kw">=</span> <span class="st">"H1"</span>,
  <span class="kw">analysis_id</span> <span class="kw">=</span> <span class="st">"ttest"</span>,
  <span class="kw">result</span> <span class="kw">=</span> <span class="st">"p.value"</span>,
  <span class="kw">operator</span> <span class="kw">=</span> <span class="st">"&lt;"</span>,
  <span class="kw">comparator</span> <span class="kw">=</span> <span class="fl">0.05</span>)

<span class="co"># Add evaluation rules for corroboration and falsification</span>
<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_eval.html">add_eval</a></span>(<span class="no">sim_study</span>,
                      <span class="kw">hypothesis_id</span> <span class="kw">=</span> <span class="st">"H1"</span>,
                      <span class="st">"corroboration"</span>,
                      <span class="kw">description</span> <span class="kw">=</span> <span class="st">"The hypothesis is corroborated if analysis 'ttest' is significant."</span>,
                      <span class="kw">evaluation</span> <span class="kw">=</span> <span class="st">"p_val"</span>)

<span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_eval.html">add_eval</a></span>(<span class="no">sim_study</span>,
                      <span class="kw">hypothesis_id</span> <span class="kw">=</span> <span class="st">"H1"</span>,
                      <span class="st">"falsification"</span>,
                      <span class="kw">description</span> <span class="kw">=</span> <span class="st">"The hypothesis is falsified if analysis 'ttest' is not significant."</span>,
                      <span class="kw">evaluation</span> <span class="kw">=</span> <span class="st">"!p_val"</span>)

<span class="co"># Simulate data, run analysis, and save the meta-data file nsim times</span>
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="no">nsim</span>) {
  <span class="no">sim_study</span>$<span class="no">name</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Study"</span>, <span class="no">i</span>)

  <span class="co"># Simulate some data and add it to the study</span>
  <span class="co"># it will replace the previous data with the same data_id</span>
  <span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/add_sim_data.html">add_sim_data</a></span>(
    <span class="no">sim_study</span>, <span class="kw">data_id</span> <span class="kw">=</span> <span class="st">"dat"</span>,
    <span class="kw">between</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">pet</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cat"</span>, <span class="st">"dog"</span>),
                   <span class="kw">treatment</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"control"</span>, <span class="st">"intervention"</span>)),
    <span class="kw">dv</span> <span class="kw">=</span> <span class="st">"happiness"</span>,
    <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">30</span>:<span class="fl">300</span>, <span class="fl">1</span>),
    <span class="kw">mu</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">60</span>, <span class="fl">62</span>, <span class="fl">61</span>, <span class="fl">65</span>),
    <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">18</span>,
    <span class="kw">plot</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

  <span class="co"># Run the analysis</span>
  <span class="no">sim_study</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/study_analyse.html">study_analyse</a></span>(<span class="no">sim_study</span>)

  <span class="co"># Save in machine-readable meta-study format</span>
  <span class="no">filename</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"metastudies/study%02d.json"</span>, <span class="no">i</span>)
  <span class="fu"><a href="../reference/study_save.html">study_save</a></span>(<span class="no">sim_study</span>, <span class="no">filename</span>, <span class="kw">format</span> <span class="kw">=</span> <span class="st">"json"</span>)
}</pre></body></html></div>
</div>
<div id="load-the-meta-study-files" class="section level3">
<h3 class="hasAnchor">
<a href="#load-the-meta-study-files" class="anchor"></a>Load the meta-study files</h3>
<p>We can access all information in the 50 studies by loading the .json file with the study() function.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># get all the .json files in the metastudies directory</span>
<span class="no">file_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="st">"metastudies"</span>, <span class="st">"*\\.json"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co"># load the metastudy files using scienceverse::study()</span>
<span class="no">study_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">file_list</span>, <span class="no">study</span>)</pre></body></html></div>
<p>We can get the (simulated) datasets from each study and see which variables they have in common.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># get all the datasets using the scienceverse::get_data() function</span>
<span class="no">all_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">study_list</span>, <span class="no">get_data</span>)
<span class="co"># get the column names from each dataset</span>
<span class="no">all_cols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">all_data</span>, <span class="no">names</span>)
<span class="co"># find the common column names in all datasets</span>
<span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span>(<span class="no">intersect</span>, <span class="no">all_cols</span>)</pre></body></html></div>
<pre><code>&gt; [1] "id"        "pet"       "treatment" "happiness"</code></pre>
<p>In this case, we can see all studies share 4 variables: an id, pet, treatment, and happiness column. To facilitate meta-analyses in the future in real life data sets, it would be important to have standardized variable names, or codebooks with easily searchable information about the variables in the dataset. You can see the codebook for a scienceverse meta-study with the function <code><a href="../reference/get_codebook.html">get_codebook()</a></code>.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/get_codebook.html">get_codebook</a></span>(<span class="no">sim_study</span>)</pre></body></html></div>
<pre><code>&gt; Codebook for dat (Psych-DS 0.1.0)
&gt; 
&gt; Dataset Parameters
&gt; 
&gt; * name: dat
&gt; * schemaVersion: Psych-DS 0.1.0
&gt; 
&gt; Column Parameters
&gt; 
&gt; * id (string)
&gt; * pet (string)
&gt;   * Levels
&gt;     * cat
&gt;     * dog
&gt;   * Ordered: FALSE
&gt; * treatment (string)
&gt;   * Levels
&gt;     * control
&gt;     * intervention
&gt;   * Ordered: FALSE
&gt; * happiness (float)</code></pre>
<p>Checking the data quality remains an important step before performing a meta-analysis based on available meta-study files. We are not suggesting a meta-analysis can be performed automatically. But if a researcher has information about the variables collected in a study, the process of combining studies becomes straightforward if we can read in meta-study files that contain the raw data and details about the tests that are performed.</p>
<p>For example, for the last study we simulated, we have information about the analyses that were performed:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/output_analyses.html">output_analyses</a></span>(<span class="no">sim_study</span>)</pre></body></html></div>
<p>We know a <em>t</em>-test was performed. We can examine the results of the study:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/output_results.html">output_results</a></span>(<span class="no">sim_study</span>)</pre></body></html></div>
<p>We see a single hypothesis was tested, and corroborated, in this study. For a <em>z</em>-curve or <em>p</em>-curve analysis, this makes it easy to select the test to include in the meta-analysis. If multiple tests are performed in a single study, we can select the hypothesis test of interest by specifying the ID.</p>
<p>The results can be accessed easily with the get_result function. For the <em>z</em>-curve and <em>p</em>-curve analysis we would retrieve the <em>p</em>-value.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Get all results</span>
<span class="fu"><a href="../reference/get_result.html">get_result</a></span>(<span class="no">sim_study</span>)</pre></body></html></div>
<pre><code>&gt; * statistic: -3.4392621
&gt; * parameter: 1191.9927132
&gt; * p.value: 0.0006035
&gt; * conf.int: 
&gt;   * -5.6693947
&gt;   * -1.5506558
&gt; * estimate: 
&gt;   * mean in group control: 59.511396
&gt;   * mean in group intervention: 63.1214213
&gt; * null.value: 0
&gt; * stderr: 1.0496511
&gt; * alternative: two.sided
&gt; * method: Welch Two Sample t-test
&gt; * data.name: happiness by treatment
&gt; * n: 
&gt;   * control: 598
&gt;   * intervention: 598</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Or only get the p-value</span>
<span class="fu"><a href="../reference/get_result.html">get_result</a></span>(<span class="no">sim_study</span>, <span class="kw">result</span> <span class="kw">=</span> <span class="st">"p.value"</span>)</pre></body></html></div>
<pre><code>&gt; [1] 0.0006035</code></pre>
<p>To perform a meta-analysis we need to compute the effect size and we need to code the sample size. These can be approximated from the test results (e.g., by calculating these from the <em>t</em>-value and degrees of freedom). However, if the data is shared, we can also compute the effect size based on the raw data. Data can be read in using the get_data function:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/get_data.html">get_data</a></span>(<span class="no">sim_study</span>))</pre></body></html></div>
<pre><code>&gt;        id pet treatment happiness
&gt; 1.1 S0001 cat   control  62.04273
&gt; 1.2 S0002 cat   control  60.15729
&gt; 1.3 S0003 cat   control  67.74260
&gt; 1.4 S0004 cat   control  57.68412
&gt; 1.5 S0005 cat   control  35.20732
&gt; 1.6 S0006 cat   control  57.91921</code></pre>
<p>We will now illustrate how these functions, together with the meta-study files, can be used to perform a <em>z</em>-curve analysis, an effect size meta-analysis, and a <em>p</em>-curve analysis.</p>
</div>
</div>
<div id="z-curve-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#z-curve-analysis" class="anchor"></a>Z-curve analysis</h1>
<p>There are several meta-analytic techniques to examine the literature. A relatively novel technique is <em>z</em>-curve, which is basically a meta-analysis of observed power (Bartos &amp; Schimmack, 2020; Schimmack &amp; Brunner, 2020). This analysis can be used to examine selection bias in the literature. Scientists often selectively report only statistically significant results in their manuscript, and fail to report non-significant tests they have performed. This selection for significant results introduces bias in the scientific literature.</p>
<p>Like a traditional meta-analysis, <em>z</em>-curve transforms observed test results (<em>p</em>-values) into <em>z</em>-scores. Using mixtures of normal distributions centered at means 0 to 6, <em>z</em>-curve aims to estimate the average power of the studies. The newest version of <em>z</em>-curve then calculates the <em>observed discovery rate</em> (the percentage of significant results, or the observed power), the <em>expected discovery rate</em> (EDR: the proportion of the area under the curve on the right side of the significance criterion) and the expected replication rate (ERR: the proportion of successfully replicated significant studies from all significant studies). <em>Z</em>-curve is able to correct for selection bias for positive results (under specific assumptions), and can estimate the EDR and ERR using only the significant <em>p</em>-values.</p>
<p>To examine the presence of bias, it is preferable to submit non-significant and significant <em>p</em>-values to a <em>z</em>-curve analysis, even if only the significant <em>p</em>-values are used to produce estimates. Publication bias can then be examined by comparing the ODR to the EDR. If the results of studies are shared in a well-structured meta-study file, all the <em>p</em>-values needed to perform a <em>z</em>-curve analysis are directly available, and it is clear which statistical test is related to a hypothesis is researchers are interested in including only specific analyses in the <em>z</em>-curve.</p>
<p>Since our 50 simulated studies have no bias, the <em>z</em>-curve analysis should yield results that (when looking at the values not excluded by the confidence interval) represent unbiased estimates for the EDR and ERR.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># Get the p-value for each analysis</span>
<span class="no">p_vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">study_list</span>, <span class="no">get_result</span>, <span class="kw">result</span><span class="kw">=</span><span class="st">'p.value'</span>)
<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">1</span>-<span class="no">p_vals</span>/<span class="fl">2</span>)
<span class="co"># Perform the z-curve analysis using the z-curve package</span>
<span class="no">z_res</span> <span class="kw">&lt;-</span> <span class="kw pkg">zcurve</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/zcurve/man/zcurve.html">zcurve</a></span>(<span class="no">z</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"EM"</span>, <span class="kw">bootstrap</span> <span class="kw">=</span> <span class="fl">1000</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">z_res</span>, <span class="kw">annotation</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">CI</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="meta_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">z_res</span>)</pre></body></html></div>
<pre><code>&gt; Call:
&gt; zcurve::zcurve(z = z, method = "EM", bootstrap = 1000)
&gt; 
&gt; Estimates:
&gt;       ERR       EDR 
&gt; 0.6558697 0.6175144</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">z_res</span>, <span class="kw">all</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>&gt; Call:
&gt; zcurve::zcurve(z = z, method = "EM", bootstrap = 1000)
&gt; 
&gt; model: EM via EM
&gt; 
&gt;               Estimate  l.CI  u.CI
&gt; ERR              0.656 0.486 0.881
&gt; EDR              0.618 0.466 0.881
&gt; Soric FDR        0.033 0.007 0.060
&gt; File Drawer R    0.619 0.135 1.146
&gt; Expected N          49    34    64
&gt; Missing N           -1   -16    14
&gt; 
&gt; Model converged in 88 + 39 iterations
&gt; Fitted using 30 z-values. 50 supplied, 30 significant (ODR = 0.60, 95% CI [0.45, 0.73]).
&gt; Q = -26.60, 95% CI[-30.08, -20.66]</code></pre>
<p>We see that 30 out of 50 studies were significant, which makes the observed power (across all these studies with different sample sizes) 60% (95% CI[0.45;0.73]). The expected discovery rate (EDR) does not statistically differ from the observed discovery rate, which means there is no indication of selection bias based on the <em>z</em>-curve analysis (and indeed, we know there was no selection bias in the simulation).</p>
</div>
<div id="meta-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#meta-analysis" class="anchor"></a>Meta-Analysis</h1>
<p>The studies all had as their main goal to examine the effect of a treatment on happiness, but all studies also collected data on the pet each participant had. Because the raw data is saved in scienceverse, and all studies share the variables <em>pet</em> (dog vs cat) and <em>happiness</em>, we can easily perform a meta-analysis across all studies for both the effect of type of pet and the treatment on happiness.</p>
<p>We first perform a meta-analysis for the effect of pets and then a meta-analysis for the effect of treatment, across all studies. We do this by grouping all raw datasets together in a single dataset with <strong>study</strong> as an identifier using <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows()</a></code>.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="co"># Create a single meta-analysis dataframe</span>
<span class="no">merged_data</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">all_data</span>, <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"study"</span>)</pre></body></html></div>
<p>Then we can calculate means, standard deviations, and get the sample sizes for all conditions (grouped based on pet, or treatment). We can use these descriptives to compute effect sizes for each study using the metafor package. We then perform a meta-analysis on the effect sizes computed from all studies.</p>
<p>We first perform the meta-analysis for the difference between pets and dogs on happiness.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># Create summary dataframe with means, sd, and n for pet effect </span>
<span class="no">MA_sum</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">merged_data</span>, <span class="no">pet</span>, <span class="no">study</span>)
<span class="no">MA_sum</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="no">MA_sum</span>,
                           <span class="kw">m</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">happiness</span>),
                           <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">happiness</span>),
                           <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">happiness</span>))</pre></body></html></div>
<pre><code>&gt; `summarise()` regrouping output by 'pet' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">ma_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/escalc.html">escalc</a></span>(<span class="kw">m1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">m</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">m2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">m</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">sd1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">sd</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">sd2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">sd</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">n1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">n</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">n2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">n</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">measure</span> <span class="kw">=</span> <span class="st">"SMD"</span>)
<span class="no">res</span> <span class="kw">&lt;-</span> <span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/rma.uni.html">rma</a></span>(<span class="no">yi</span>, <span class="no">vi</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">ma_dat</span>, <span class="kw">measure</span> <span class="kw">=</span> <span class="st">"SMD"</span>)
<span class="no">res</span></pre></body></html></div>
<pre><code>&gt; 
&gt; Random-Effects Model (k = 50; tau^2 estimator: REML)
&gt; 
&gt; tau^2 (estimated amount of total heterogeneity): 0 (SE = 0.0011)
&gt; tau (square root of estimated tau^2 value):      0
&gt; I^2 (total heterogeneity / total variability):   0.00%
&gt; H^2 (total variability / sampling variability):  1.00
&gt; 
&gt; Test for Heterogeneity:
&gt; Q(df = 49) = 42.1931, p-val = 0.7435
&gt; 
&gt; Model Results:
&gt; 
&gt; estimate      se     zval    pval    ci.lb    ci.ub 
&gt;  -0.1010  0.0108  -9.3618  &lt;.0001  -0.1222  -0.0799  *** 
&gt; 
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/forest.html">forest</a></span>(<span class="no">res</span>)</pre></body></html></div>
<p><img src="meta_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
<p>Then we perform the meta-analysis for the treatment effect.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="co"># Create summary dataframe for treatment effect</span>
<span class="no">MA_sum</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">merged_data</span>, <span class="no">treatment</span>, <span class="no">study</span>)
<span class="no">MA_sum</span> <span class="kw">&lt;-</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="no">MA_sum</span>,
                           <span class="kw">m</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">happiness</span>),
                           <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">happiness</span>),
                           <span class="kw">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">happiness</span>))</pre></body></html></div>
<pre><code>&gt; `summarise()` regrouping output by 'treatment' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">ma_dat</span> <span class="kw">&lt;-</span> <span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/escalc.html">escalc</a></span>(<span class="kw">m1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">m</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">m2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">m</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">sd1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">sd</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">sd2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">sd</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">n1</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">n</span>[<span class="fl">1</span>:<span class="no">nsim</span>],
                          <span class="kw">n2</span> <span class="kw">=</span> <span class="no">MA_sum</span>$<span class="no">n</span>[(<span class="no">nsim</span>+<span class="fl">1</span>):(<span class="no">nsim</span>*<span class="fl">2</span>)],
                          <span class="kw">measure</span> <span class="kw">=</span> <span class="st">"SMD"</span>)

<span class="no">res</span> <span class="kw">&lt;-</span> <span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/rma.uni.html">rma</a></span>(<span class="no">yi</span>, <span class="no">vi</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">ma_dat</span>, <span class="kw">measure</span> <span class="kw">=</span> <span class="st">"SMD"</span>)
<span class="no">res</span></pre></body></html></div>
<pre><code>&gt; 
&gt; Random-Effects Model (k = 50; tau^2 estimator: REML)
&gt; 
&gt; tau^2 (estimated amount of total heterogeneity): 0 (SE = 0.0011)
&gt; tau (square root of estimated tau^2 value):      0
&gt; I^2 (total heterogeneity / total variability):   0.00%
&gt; H^2 (total variability / sampling variability):  1.00
&gt; 
&gt; Test for Heterogeneity:
&gt; Q(df = 49) = 40.2735, p-val = 0.8083
&gt; 
&gt; Model Results:
&gt; 
&gt; estimate      se      zval    pval    ci.lb    ci.ub 
&gt;  -0.1779  0.0108  -16.4665  &lt;.0001  -0.1991  -0.1567  *** 
&gt; 
&gt; ---
&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="kw pkg">metafor</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/metafor/man/forest.html">forest</a></span>(<span class="no">res</span>)</pre></body></html></div>
<p><img src="meta_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>In this case, not only were the meta-study files well structured, but all studies were identical. In practice, researchers would most likely need to organize the data in meta-study files so that it can be used for their analysis (e.g., generating additional grouping variables) but having the data, codebook, and analyses all accessible should greatly facilitate meta-analyses even for different sets of studies. If fields are able to standardize their measures and create shared naming conventions, one could search datasets across all available meta-study files to identify relevant studies.</p>
</div>
<div id="p-curve-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#p-curve-analysis" class="anchor"></a>P-curve Analysis</h1>
<p>A <em>p</em>-curve analysis examines the distribution of <em>p</em>-values, and compares the distribution against the predicted pattern when the null-hypothesis is true, or when there is a true effect tested with some assumed power (Simonsohn, Nelson, &amp; Simmons, 2014). Performing a <em>p</em>-curve analysis requires the results of statistical tests to be entered. The analysis can be performed by either retrieving the test statistics, and converting these to <em>p</em>-values, or by directly using the <em>p</em>-values (as we do in the code below).</p>
<p>Since our simulated studies have no bias, the <em>p</em>-curve analysis should indicate that the pattern of <em>p</em>-values looks like what would would expect if there is a true effect (a skewed distribution, with more small <em>p</em>-values than larger <em>p</em>-values).</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># Adapted from https://github.com/nicebread/p-checker/blob/master/p-curve.R</span>

<span class="no">ncp33z</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">power</span><span class="kw">=</span><span class="fl">1</span>/<span class="fl">3</span>, <span class="no">p.crit</span><span class="kw">=</span><span class="fl">.05</span>) {
      <span class="no">xc</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="kw">p</span><span class="kw">=</span><span class="fl">1</span>-<span class="no">p.crit</span>/<span class="fl">2</span>)
      <span class="co">#Find noncentrality parameter (ncp) that leads 33% power to obtain xc</span>
      <span class="no">f</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">delta</span>, <span class="no">pr</span>, <span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="no">x</span>, <span class="kw">mean</span> <span class="kw">=</span> <span class="no">delta</span>) - (<span class="fl">1</span>-<span class="no">power</span>)
      <span class="no">out</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html">uniroot</a></span>(<span class="no">f</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">37.62</span>), <span class="kw">x</span> <span class="kw">=</span> <span class="no">xc</span>)
      <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">out</span>$<span class="no">root</span>)
}

<span class="no">theoretical_power_curve</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">power</span><span class="kw">=</span><span class="fl">1</span>/<span class="fl">3</span>, <span class="no">p.max</span><span class="kw">=</span><span class="fl">.05</span>, <span class="no">normalize</span><span class="kw">=</span><span class="fl">TRUE</span>) {
    <span class="co"># compute arbitrary test statistics for requested power</span>
    <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pwr</span>)
    <span class="no">d</span> <span class="kw">&lt;-</span> <span class="fl">0.2</span>
    <span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pwr/man/pwr.t.test.html">pwr.t.test</a></span>(<span class="kw">d</span><span class="kw">=</span><span class="fl">0.2</span>, <span class="kw">power</span><span class="kw">=</span><span class="no">power</span>)$<span class="no">n</span>*<span class="fl">2</span>

    <span class="no">crit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.01</span>, <span class="no">p.max</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">.01</span>)
    <span class="no">pdens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>()
    <span class="kw">for</span> (<span class="no">cr</span> <span class="kw">in</span> <span class="no">crit</span>) {
        <span class="no">pdens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">pdens</span>, <span class="fu"><a href="https://rdrr.io/pkg/pwr/man/pwr.t.test.html">pwr.t.test</a></span>(<span class="kw">d</span><span class="kw">=</span><span class="fl">0.2</span>, <span class="kw">power</span><span class="kw">=</span><span class="kw">NULL</span>, <span class="kw">n</span><span class="kw">=</span><span class="no">n</span>/<span class="fl">2</span>, <span class="kw">sig.level</span><span class="kw">=</span><span class="no">cr</span>)$<span class="no">power</span>)
    }
    <span class="no">p.dens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">pdens</span>))
    <span class="kw">if</span> (<span class="no">normalize</span> <span class="kw">==</span> <span class="fl">TRUE</span>) <span class="no">p.dens</span> <span class="kw">&lt;-</span> <span class="no">p.dens</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">p.dens</span>)

    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">p.dens</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">crit</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">p.dens</span>)
}

<span class="no">p.crit</span><span class="kw">=</span><span class="fl">.05</span>
<span class="no">power</span><span class="kw">=</span><span class="fl">1</span>/<span class="fl">3</span>

<span class="co">#get p-values from scienceverse studylist</span>
<span class="no">p_vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">study_list</span>, <span class="no">get_result</span>, <span class="kw">result</span><span class="kw">=</span><span class="st">'p.value'</span>)
<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>()

<span class="no">z</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="no">p_vals</span>/<span class="fl">2</span>, <span class="kw">lower.tail</span><span class="kw">=</span><span class="fl">FALSE</span>)
<span class="no">ppr</span> <span class="kw">&lt;-</span> <span class="no">p_vals</span>*(<span class="fl">1</span>/<span class="no">p.crit</span>)    <span class="co"># pp-value for right-skew </span>
<span class="no">ppl</span> <span class="kw">&lt;-</span> <span class="fl">1</span>-<span class="no">ppr</span>        <span class="co"># pp-value for left-skew</span>
<span class="no">ncp33</span> <span class="kw">&lt;-</span> <span class="fu">ncp33z</span>(<span class="kw">power</span><span class="kw">=</span><span class="no">power</span>, <span class="kw">p.crit</span><span class="kw">=</span><span class="no">p.crit</span>)
<span class="no">pp33</span> <span class="kw">&lt;-</span> (<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="no">z</span>, <span class="kw">mean</span><span class="kw">=</span><span class="no">ncp33</span>, <span class="kw">sd</span><span class="kw">=</span><span class="fl">1</span>)-(<span class="fl">1</span>-<span class="no">power</span>))*(<span class="fl">1</span>/<span class="no">power</span>)

<span class="no">res</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">p</span><span class="kw">=</span><span class="no">p_vals</span>, <span class="kw">ppr</span><span class="kw">=</span><span class="no">ppr</span>, <span class="kw">ppl</span><span class="kw">=</span><span class="no">ppl</span>, <span class="kw">pp33</span><span class="kw">=</span><span class="no">pp33</span>))

<span class="co"># recode extreme values </span>

<span class="no">res</span>$<span class="no">ppr</span>[<span class="no">res</span>$<span class="no">ppr</span> <span class="kw">&lt;</span> <span class="fl">.00001</span>] <span class="kw">&lt;-</span> <span class="fl">.00001</span>
<span class="no">res</span>$<span class="no">ppl</span>[<span class="no">res</span>$<span class="no">ppl</span> <span class="kw">&lt;</span> <span class="fl">.00001</span>] <span class="kw">&lt;-</span> <span class="fl">.00001</span>
<span class="no">res</span>$<span class="no">pp33</span>[<span class="no">res</span>$<span class="no">pp33</span> <span class="kw">&lt;</span> <span class="fl">.00001</span>] <span class="kw">&lt;-</span> <span class="fl">.00001</span>
<span class="no">res</span>$<span class="no">ppr</span>[<span class="no">res</span>$<span class="no">ppr</span> <span class="kw">&gt;</span> <span class="fl">.99999</span>] <span class="kw">&lt;-</span> <span class="fl">.99999</span>
<span class="no">res</span>$<span class="no">ppl</span>[<span class="no">res</span>$<span class="no">ppl</span> <span class="kw">&gt;</span> <span class="fl">.99999</span>] <span class="kw">&lt;-</span> <span class="fl">.99999</span>
<span class="no">res</span>$<span class="no">pp33</span>[<span class="no">res</span>$<span class="no">pp33</span> <span class="kw">&gt;</span> <span class="fl">.99999</span>] <span class="kw">&lt;-</span> <span class="fl">.99999</span>

<span class="co"># remove non-significant values</span>
<span class="no">res</span>[<span class="no">res</span>$<span class="no">p</span> <span class="kw">&gt;</span> <span class="no">p.crit</span>, ] <span class="kw">&lt;-</span> <span class="fl">NA</span>

<span class="co"># New p-curve computation (p-curve app 3.0, http://www.p-curve.com/app3/)</span>
<span class="no">p_curve_3</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">pps</span>) {

    <span class="no">pps</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">pps</span>)

    <span class="co"># STOUFFER: Overall tests aggregating pp-values</span>
    <span class="no">ktot</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">pps</span>$<span class="no">ppr</span>))
    <span class="no">Z_ppr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="no">pps</span>$<span class="no">ppr</span>))/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">ktot</span>)          <span class="co"># right skew</span>
    <span class="no">Z_ppl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="no">pps</span>$<span class="no">ppl</span>))/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">ktot</span>)          <span class="co"># left skew</span>
    <span class="no">Z_pp33</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="no">pps</span>$<span class="no">pp33</span>))/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">ktot</span>)         <span class="co"># 33%</span>

    <span class="no">p_ppr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="no">Z_ppr</span>)
    <span class="no">p_ppl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="no">Z_ppl</span>)
    <span class="no">p_pp33</span><span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span>(<span class="no">Z_pp33</span>)

    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
        <span class="kw">Z_evidence</span> <span class="kw">=</span> <span class="no">Z_ppr</span>,
        <span class="kw">p_evidence</span> <span class="kw">=</span> <span class="no">p_ppr</span>,
        <span class="kw">Z_hack</span> <span class="kw">=</span> <span class="no">Z_ppl</span>,
        <span class="kw">p_hack</span> <span class="kw">=</span> <span class="no">p_ppl</span>,
        <span class="kw">Z_lack</span> <span class="kw">=</span> <span class="no">Z_pp33</span>,
        <span class="kw">p_lack</span> <span class="kw">=</span> <span class="no">p_pp33</span>,
        <span class="kw">inconclusive</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">p_ppr</span><span class="kw">&gt;</span><span class="fl">.05</span> <span class="kw">&amp;</span> <span class="no">p_ppl</span><span class="kw">&gt;</span><span class="fl">.05</span> <span class="kw">&amp;</span> <span class="no">p_pp33</span><span class="kw">&gt;</span><span class="fl">.05</span>, <span class="fl">TRUE</span>, <span class="fl">FALSE</span>)))
}

<span class="fu">p_curve_3</span>(<span class="kw">pps</span> <span class="kw">=</span> <span class="no">res</span>)</pre></body></html></div>
<pre><code>&gt; $Z_evidence
&gt; [1] -7.573427
&gt; 
&gt; $p_evidence
&gt; [1] 0.0000000000000181753
&gt; 
&gt; $Z_hack
&gt; [1] 7.573427
&gt; 
&gt; $p_hack
&gt; [1] 1
&gt; 
&gt; $Z_lack
&gt; [1] 3.388543
&gt; 
&gt; $p_lack
&gt; [1] 0.9996487
&gt; 
&gt; $inconclusive
&gt; [1] FALSE</code></pre>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co"># Create p-curve plot</span>

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">NA</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">p.crit</span>), <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">100</span>), <span class="kw">xlab</span><span class="kw">=</span><span class="st">"p-value"</span>, <span class="kw">ylab</span><span class="kw">=</span><span class="st">"Percentage of p values"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">h</span><span class="kw">=</span><span class="fl">1</span>/<span class="no">p.crit</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"solid"</span>, <span class="st">"dotted"</span>, <span class="st">"dashed"</span>), <span class="kw">col</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dodgerblue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"red"</span>), <span class="kw">legend</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Observed p-curve"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">power</span>,<span class="fl">2</span>), <span class="st">"% power curve"</span>), <span class="st">"Nil effect"</span>), <span class="kw">bty</span><span class="kw">=</span><span class="st">"n"</span>)

<span class="no">bins</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">res</span>$<span class="no">p</span>, <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="no">p.crit</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">.01</span>)))
<span class="no">perc</span> <span class="kw">&lt;-</span> (<span class="no">bins</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">bins</span>))*<span class="fl">100</span>

<span class="co"># empirical p-curve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="no">p.crit</span>-<span class="fl">.01</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">.01</span>)+<span class="fl">.005</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">perc</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"dodgerblue"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)

<span class="co"># 33% (or any other) power curve</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="no">p.crit</span>-<span class="fl">.01</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">.01</span>)+<span class="fl">.005</span>, <span class="kw">y</span><span class="kw">=</span><span class="fu">theoretical_power_curve</span>(<span class="no">power</span>, <span class="kw">p.max</span><span class="kw">=</span><span class="no">p.crit</span>)*<span class="fl">100</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"darkgreen"</span>, <span class="kw">lty</span><span class="kw">=</span><span class="st">"dashed"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">2</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="no">p.crit</span>-<span class="fl">.01</span>, <span class="kw">by</span><span class="kw">=</span><span class="fl">.01</span>)+<span class="fl">.006</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">perc</span> + <span class="fl">8</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"black"</span>, <span class="kw">label</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">perc</span>), <span class="st">"%"</span>), <span class="kw">cex</span><span class="kw">=</span>)</pre></body></html></div>
<p><img src="meta_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lisa DeBruine, Daniel Lakens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
